name: Build

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  windows:
    name: Windows (Release)
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4

    - name: Configure
      run: cmake -S . -B build -G "Visual Studio 17 2022"

    - name: Build (Release)
      run: cmake --build build --config Release --target AlienInvaders -j

    - name: List build output (diagnostic)
      shell: pwsh
      run: |
        Write-Host "=== Top level ==="
        Get-ChildItem -Force
        Write-Host "=== build/Release ==="
        if (Test-Path build/Release) { Get-ChildItem -Recurse build/Release | Select-Object FullName } else { Write-Host "No build/Release folder" }
        Write-Host "=== Searching for .exe under repo ==="
        Get-ChildItem -Recurse -Filter *.exe | Select-Object FullName

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: AlienInvaders-windows
        path: |
          **/*.exe
          dist/**
        if-no-files-found: error

  # web:
  #   name: Web (Emscripten Release)
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4

  #     - name: Setup Emscripten
  #       uses: mymindstorm/setup-emsdk@v14
  #       with:
  #         version: 4.0.22

  #     - name: Configure (emcmake)
  #       run: emcmake cmake -S . -B build-web -DCMAKE_BUILD_TYPE=Release

  #     - name: Build
  #       run: cmake --build
